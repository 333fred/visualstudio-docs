---
title: "MSB4248 diagnostic code"
description: "Cannot expand metadata in expression 'value'."
ms.date: 12/06/2024
ms.topic: "error-reference"
f1_keywords:
 - MSB4248
 - MSBuild.CannotExpandItemMetadata
dev_langs:
  - "VB"
  - "CSharp"
  - "C++"
  - "FSharp"
author: ghogen
ms.author: ghogen
manager: mijacobs
ms.subservice: msbuild
---

# MSB4248 diagnostic code

<!-- :::ErrorDefinitionDescription::: -->
<!-- :::editable-content name="introDescription"::: -->
This article describes the MSB4248 error code.
<!-- :::editable-content-end::: -->

## Message text

```output
MSB4248: Cannot expand metadata in expression 'value'.
```

<!-- :::editable-content name="postOutputDescription"::: -->
<!--
{StrBegin="MSB4248: "}UE: This message is shown when metadata cannot be expanded in an expression for some reason e.g. trying to apply
    %(RootDir) to an item-spec that's not a valid path would result in this error.
    LOCALIZATION: "{1}" is a localized message explaining the problem.
-->

## Analysis of MSB4248 Error Code

The MSB4248 error code signifies an issue where MSBuild is unable to expand or resolve metadata for an item. This typically occurs when metadata is referenced incorrectly or does not exist in the current context.

### Instance 1: Metadata Expansion During Task Execution

#### **Context**
The error is logged when MSBuild tries to expand item metadata in a task parameter but fails. Specifically, this occurs when metadata is referenced in a string format using the `%(MetadataName)` syntax, and the metadata is invalid or unavailable for the item in question.

The relevant code snippet is usually found in the logic responsible for parsing and evaluating item metadata during task execution. For example:
```csharp
ProjectErrorUtilities.ThrowInvalidProject(
    element.Location,
    "CannotExpandItemMetadata",
    metadataName);
```

#### **Possible Cause**
- The metadata being referenced does not exist for the item.
- The item group containing the metadata is empty, or the metadata key is misspelled.
- The context in which the metadata is expanded does not have access to the specified metadata (e.g., referencing metadata from an unrelated item group).

#### **Resolution/Workaround**
1. **Verify Metadata Existence**:
   - Ensure the metadata key you are referencing exists for all items in the group. Use logging or debugging to inspect the item group and its metadata.
   - Example: If referencing `%(FullPath)`, ensure the items in the group have a `FullPath` metadata.

2. **Correct Metadata Scope**:
   - Confirm that the metadata is being referenced in the proper context. If the reference is outside the scope of the item group, it will fail.

3. **Fallback Handling**:
   - Use conditionals or default values to handle cases where metadata might be missing, e.g., `${(MetadataName ?? "DefaultValue")}`.

### Instance 2: Metadata Expansion Within String Interpolation

#### **Context**
The error occurs when metadata is used in a string interpolation scenario but cannot be resolved. For example, within an MSBuild target, metadata is interpolated into a property or message string, and the system fails to find the specified metadata.

The code path for this error is often related to the string parsing logic that replaces `%(MetadataName)` placeholders.

#### **Possible Cause**
- The metadata reference syntax might be invalid (e.g., unclosed parentheses in `%(MetadataName)`).
- The metadata is being referenced from an item group that does not define it.

#### **Resolution/Workaround**
1. **Validate Syntax**:
   - Ensure the metadata reference follows the correct syntax, e.g., `%(MetadataName)` without typos or unbalanced parentheses.

2. **Use Default Metadata**:
   - Assign default values to metadata during item group definition to prevent null references. For example:
     ```xml
     <ItemGroup>
         <MyItem Include="file.txt">
             <MyMetadata>DefaultValue</MyMetadata>
         </MyItem>
     </ItemGroup>
     ```

3. **Use Fallback Properties**:
   - Use properties or conditions to handle missing metadata. For instance:
     ```xml
     <PropertyGroup>
         <ResolvedPath Condition="'%(MyItem.FullPath)' != ''">%(MyItem.FullPath)</ResolvedPath>
         <ResolvedPath Condition="'%(MyItem.FullPath)' == ''">FallbackValue</ResolvedPath>
     </PropertyGroup>
     ```

### Instance 3: Metadata Expansion in Target Inputs/Outputs

#### **Context**
This error may also be logged when expanding metadata in the inputs or outputs of a target. Targets often use item metadata to dynamically define their inputs and outputs, and failure to resolve metadata results in this error.

The relevant code is tied to the target execution logic that processes metadata during the build workflow.

#### **Possible Cause**
- The metadata is being referenced before it is defined (e.g., an item group is populated after the target references its metadata).
- The referenced metadata does not exist for the items being used in the target.

#### **Resolution/Workaround**
1. **Ensure Metadata Is Defined**:
   - Check that the metadata is defined before the target execution. Rearrange the project file to define item groups and metadata before they are referenced.

2. **Debug Item Group Population**:
   - Examine whether the item group used in the target has the expected items and metadata. Use diagnostic logging to inspect the build process:
     ```xml
     <Message Text="Item metadata: %(MyItem.MetadataName)" Importance="High" />
     ```

3. **Fallback or Conditional Targets**:
   - Use conditions in targets to handle cases where metadata might not exist:
     ```xml
     <Target Name="MyTarget" Condition="'%(MyItem.MetadataName)' != ''">
         <!-- Target logic here -->
     </Target>
     ```

## General Recommendations

1. **Enable Diagnostic Logging**:
   - Use the `/v:diag` (diagnostic verbosity) switch when running MSBuild to inspect detailed logs about metadata resolution.

2. **Validate Project File Structure**:
   - Ensure that item groups and metadata are defined in a logical order, and avoid referencing metadata before items are defined.

3. **Leverage Default Metadata**:
   - MSBuild provides built-in metadata (e.g., `%(Filename)`, `%(Extension)`, `%(FullPath)`). Use these where applicable to minimize the need for custom metadata.

---

By carefully reviewing the project structure and MSBuild logs, you can resolve issues related to the MSB4248 error and ensure smooth metadata resolution during builds.

<!-- :::editable-content-end::: -->
<!-- :::ErrorDefinitionDescription-end::: -->

## Applies to

All versions of MSBuild
